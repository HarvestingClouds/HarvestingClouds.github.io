<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="BloggerCMS" />
    <meta name="description" content="Blog about all things regarding private and public clouds">
    <meta name="author" content="@20aman">

    <title>Step by Step ARM Templates - Iterating and creating multiple instances of a resource :: Harvesting Clouds</title>

    <!-- rss feed url -->
    <link rel="alternate" type="application/rss+xml" title="Harvesting Clouds" href="http://HarvestingClouds.com/rss.xml"/>

    <!-- favicon -->
    <link rel="shortcut icon" href="/favicon.ico"/>
    <link rel="shortcut icon" href="http://HarvestingClouds.com/favicon.ico"/>

    <!-- Bootstrap CSS file -->
    <link href="http://HarvestingClouds.com/js/plugins/bootstrap-3.0.3/css/cerulean.min.css" rel="stylesheet"/>
    <link href="http://HarvestingClouds.com/js/plugins/font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://HarvestingClouds.com/js/plugins/bootstrap-3.0.3/plugins/social-buttons.css" rel="stylesheet"/>

    <!-- syntax highlighter css file -->
    <link href="http://HarvestingClouds.com/js/plugins/highlight/styles/github.css" rel="stylesheet"/>

    <!-- lightbox for images -->
    <link href="http://HarvestingClouds.com/js/plugins/lightbox/ekko-lightbox.min.css" rel="stylesheet"/>

    <!-- blog custom CSS file -->
    <link href="http://HarvestingClouds.com/css/style.css" rel="stylesheet"/>
</head><body>
<!-- Header -->
<header class="navbar navbar-default
 navbar-fixed-top bs-docs-nav" role="banner">
    <div class="container">

        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a href="http://HarvestingClouds.com" class="navbar-brand">Harvesting Clouds</a>

        </div>


        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
            <div class="navbar-form navbar-right" role="search">
                <div class="form-group">
                    <input type="text" class="searchQuery form-control" placeholder="Search Posts">
                </div>

                <button type="button" class="searchButton btn btn-default"><i class="glyphicon glyphicon-search"></i>
                    Submit
                </button>
            </div>

            <ul class="nav navbar-nav page-links">
                <li><a href="http://HarvestingClouds.com/posts.html">All Posts</a></li>
                    <li><a href="http://HarvestingClouds.com/page/about-me">About Me</a></li>
            </ul>

        </nav>
    </div>
</header>
<div class="container">
    <div class="row">
        <div class="col-md-8 main-content">
            <article>
                <h3>Step by Step ARM Templates - Iterating and creating multiple instances of a resource</h3>
                <span class="glyphicon glyphicon-user"></span> @20aman
                &nbsp;&nbsp;
                <span class="glyphicon glyphicon-time"></span> Sep 27, 2016
                <hr>

                <p class="post-content"><p>In Azure Resource Manager (ARM) templates, you can define the variable once and then iterate/loop over that definition and create multiple instances of that resource.
There are 3 special constructs in ARM templates to help you with this. </p>
<p>These <strong>constructs</strong> are:</p>
<ul>
<li><strong>copy</strong> - This is a property that is defined within the resource. This is the construct which when defined indicates that this resource needs to be looped over and created multiple times. It also specifies the number of times to iterate via &quot;count&quot; property.</li>
<li><strong>copyIndex()</strong> - Used to access the current iteration value. Its value for the first iteration is <strong>zero</strong>. For the second iteration, its value is 1 and so on... You can pass it an integer (number) as a parameter. Whatever number you pass that will become the value for the first iteration and subsequent iterations. E.g. copyIndex(20) will compute to 20 in the first iteration, 21 in the second iteration and so on.</li>
<li><strong>length</strong> - This is the method of arrays. It computes the number of elements in an array. It can be used to set the &quot;count&quot; property of &quot;copy&quot; construct.</li>
</ul>
<p><strong>Note:</strong> Arrays are always <strong>zero indexed</strong>. What that means is that the first element of the array is indexed at 0, the second element of the array is indexed at 1, and so on...</p>
<h3>1. Simple Example</h3>
<p>Let us understand these constructs using an example.</p>
<pre><code>"parameters": { 
  "count": { 
    "type": "int", 
    "defaultValue": 3 
  } 
}, 
"resources": [ 
  { 
      "name": "[concat('HarvestingClouds-', copyIndex(100))]", 
      "type": "Microsoft.Web/sites", 
      "location": "Central US", 
      "apiVersion": "2015-08-01",
      "copy": { 
         "name": "websitescopy", 
         "count": "[parameters('count')]" 
      }, 
      "properties": {
          "serverFarmId": "hostingPlanName"
      }
  } 
]</code></pre>
<p>The above example will <strong>result</strong> in creation of below 3 web apps in Azure:</p>
<ul>
<li>HarvestingClouds-100</li>
<li>HarvestingClouds-101</li>
<li>HarvestingClouds-102</li>
</ul>
<p>Note the usage of &quot;copy&quot; property in the above code example:</p>
<pre><code> "copy": { 
             "name": "websitescopy", 
             "count": "[parameters('count')]" 
          }</code></pre>
<p>As you can notice above, the value of this property is another JSON object. This object has further two properties: </p>
<ul>
<li>First is the name property, which provides the name to the looping construct. This can be any meaningful name. </li>
<li>The second property is the count, which specifies how many times this resource definition should be deployed. Note that the value is set to the parameter named &quot;count&quot;. The name of the parameter can be anything but the value of the parameter has to be a number (i.e. an integer).</li>
</ul>
<p>Next, note how the name of the web application is constructed using the copyIndex() helper function.</p>
<pre><code>"name": "[concat('HarvestingClouds-', copyIndex(100))]"</code></pre>
<p>The above value uses two helper functions. First is the &quot;concat()&quot; which is concatenating (i.e. joining) two values. First value is the prefix string &quot;HarvestingClouds-&quot;. Second parameter and the second helper function is <code>copyIndex(100)</code>. This specifies the current iteration value, which is offset with 100. So for the first iteration, the value will be 0+100 = 100, for the second iteration the value will be 1+100 = 101 and so on...</p>
<h3>2. Example with an Array</h3>
<p>Let's assume that you want to deploy multiple web apps for different purposes. You need one web app for Production, one for Staging or testing and one for Development. You want to name the web apps deployed with the purpose concatenated.
The below example uses an array to set the values for the web app name:</p>
<pre><code>"parameters": { 
  "purpose": { 
     "type": "array", 
         "defaultValue": [ 
         "Production", 
         "Staging", 
         "Development" 
      ] 
  }
}, 
"resources": [ 
  { 
      "name": "[concat('HarvestingClouds-', parameters('purpose')[copyIndex()])]", 
      "type": "Microsoft.Web/sites", 
      "location": "Central US", 
      "apiVersion": "2015-08-01",
      "copy": { 
         "name": "websitescopy", 
         "count": "[length(parameters('purpose'))]" 
      }, 
      "properties": {
          "serverFarmId": "hostingPlanName"
      } 
  } 
]</code></pre>
<p>The <strong>output</strong> of the above sample will be 3 web apps deployed in Azure with following names:</p>
<ul>
<li>HarvestingClouds-Production</li>
<li>HarvestingClouds-Staging</li>
<li>HarvestingClouds-Development</li>
</ul>
<p>Note in the above code sample that the parameter &quot;purpose&quot; is an array with 3 values i.e. Production, Staging, and Development. Then in the &quot;copy&quot; construct the count property is set using the length of this array as shown below. As there are 3 elements in the array, the value of count will be 3 and the resource will be deployed 3 times.</p>
<pre><code>"count": "[length(parameters('purpose'))]" </code></pre>
<p>Next, the name of the web app is set using the copyIndex() and the array itself as shown below:</p>
<pre><code>"name": "[concat('HarvestingClouds-', parameters('purpose')[copyIndex()])]"</code></pre>
<p>As earlier, it uses concat helper function to add two strings. The first string is simple text i.e. &quot;HarvestingClouds-&quot;, which becomes the prefix for the web app name. Second is finding out the value of the array based on the current iteration. For the first iteration, copyIndex() will compute to zero, therefore the second parameter becomes <code>parameters('purpose')[0]</code>. This will fetch the 0th element of the array which is Production. Similarly, for the second iteration, copyIndex() will compute to 1, therefore the second parameter becomes <code>parameters('purpose')[1]</code>. This will fetch the second element of the array (or element at index value 1) which is Staging, and so on...</p>
<h3>3. Depending upon resources being deployed by the copy Loop</h3>
<p>Let's assume you want to deploy a storage account. But you want to deploy it only after all the web apps are deployed by the loop. In this scenario, the dependsOn property of a resource is set to the name of the &quot;copy&quot; property of the resource, rather than the resource itself.</p>
<pre><code>    {
        "apiVersion": "2015-06-15",
        "type": "Microsoft.Storage/storageAccounts",
        "name": "teststorage101",
        "location": "[resourceGroup().location]",
        "properties": {
            "accountType": "Standard_LRS"
         }
       "dependsOn": ["websitescopy"]
    }</code></pre>
<p>Note above that the dependsOn property is set to the name property of the copy in the earlier web app example. This storage account will not be deployed until all 3 web apps are not deployed.</p>
<h3>4. Limitations</h3>
<p>There are two limitations on the use of the copy to iterate and create multiple resource instances:</p>
<ol>
<li><strong>Nested Resources</strong> - You cannot use a copy loop for a nested resource. If you need to create multiple instances of a resource that you typically define as nested within another resource, you must instead create the resource as a top-level resource and define the relationship with the parent resource through the <strong>type</strong> and <strong>name</strong> properties.</li>
<li><strong>Looping Properties of a Resource</strong> - You can only use copy on resource types, not on properties within a resource type. E.g. Creating multiple data disks within a VM.</li>
</ol>
<p>That is all there is to iterate and creating multiple resources from a single definition. When your templates will start becoming complex then these constructs/helper functions will help you a lot. E.g. you may need to deploy multiple load balanced resources, then you can use the concepts defined in this post.</p>
<p>You can also refer the official documentation here: <a href="https://azure.microsoft.com/en-us/documentation/articles/resource-group-create-multiple/">copy, copyIndex, and length</a></p></p>
                <br/><br/>

                <div class="post-info">
                        <span class="glyphicon glyphicon-folder-open"></span> &nbsp;
                        <a href="http://HarvestingClouds.com/category/azure">Azure</a>
                        &nbsp;&nbsp;

                    <span class="glyphicon glyphicon-bookmark"></span>

                        <a href="http://HarvestingClouds.com/tag/ARM">ARM</a>&nbsp;&nbsp;
                        <a href="http://HarvestingClouds.com/tag/Azure">Azure</a>&nbsp;&nbsp;
                        <a href="http://HarvestingClouds.com/tag/AzureResourceManager">AzureResourceManager</a>&nbsp;&nbsp;
                        <a href="http://HarvestingClouds.com/tag/Templates">Templates</a>&nbsp;&nbsp;
                </div>

            </article>
            <hr/>

            <div class="text-center clearfix">
                <div class="col-sm-4 col-md-4">
                    <a class="prevpost btn btn-primary"><i class="fa fa-chevron-circle-left"></i> Prev Post</a>
                </div>
                <div class="col-sm-4 col-md-4">
                    <a class="btn btn-primary" href="http://HarvestingClouds.com/posts.html"><i class="fa fa-navicon"></i> View All
                        Post</a>
                </div>
                <div class="col-sm-4 col-md-4">
                    <a class="nextpost btn btn-primary"><i class="fa fa-chevron-circle-right"></i> Next Post</a>
                </div>
            </div>

            <hr/>
            
            <!-- Comment form -->
            <div class="well">
                <div id="disqus_thread"></div>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">Comments
                    powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">Comments powered by
                    <span class="logo-disqus">Disqus</span></a>
            </div>

        </div>

        <div class="sidebar col-md-4">
        
            <!-- Follow Panel -->
                <div class="panel panel-primary text-center">
                    <div class="panel-heading">
                        <strong>Follow Me</strong>
                    </div>
        
                    <div class="panel-body">
                        <a target="_blank" href="http://HarvestingClouds.com/rss.xml" class="btn btn-social-icon btn-outline"><i class="fa fa-rss"></i></a>
        
                            <a target="_blank" href="https://twitter.com/20aman" class="btn btn-social-icon btn-twitter"><i class="fa fa-twitter"></i></a>
                            <a target="_blank" href="https://ca.linkedin.com/in/20aman" class="btn btn-social-icon btn-linkedin"><i class="fa fa-linkedin"></i></a>
                            <a target="_blank" href="https://github.com/HarvestingClouds" class="btn btn-social-icon btn-github"><i class="fa fa-github"></i></a>
                    </div>
                </div>
        
            <!-- Custom Values from Settings page -->
        
            <!-- Latest Posts -->
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <strong>Latest Posts</strong>
                </div>
        
                <ul class="list-group">
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/post/azure-remoteapp-is-going-away-new-purchases-in-portal-are-now-stopped">Azure RemoteApp is going away. New Purchases in portal are now stopped </a></li>
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/post/script-sample-generate-azure-resources-report-by-tags">Script Sample - Generate Azure Resources Report by Tags</a></li>
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/post/step-by-step-azure-resource-manager-arm-templates-index">Step by Step Azure Resource Manager (ARM) Templates - Index</a></li>
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/post/step-by-step-arm-templates-iterating-and-creating-multiple-instances-of-a-resource">Step by Step ARM Templates - Iterating and creating multiple instances of a resource</a></li>
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/post/step-by-step-arm-templates-deploying-arm-templates-using-visual-studio">Step by Step ARM Templates - Deploying ARM Templates using Visual Studio</a></li>
                </ul>
            </div>
        
            <!-- Categories -->
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <strong>Categories</strong>
                </div>
        
                <ul class="list-group">
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/category/azure">Azure</a></li>
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/category/general">General</a></li>
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/category/powershell">PowerShell</a></li>
                        <li class="list-group-item"><a href="http://HarvestingClouds.com/category/web-development">Web Development</a></li>
                </ul>
            </div>
        
            <!-- Archives -->
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <strong>Archives</strong>
                    </div>
        
                    <ul class="archives list-group"><li class="list-group-item archive_link"><a href="http://HarvestingClouds.com/archive/october-2016">October 2016</a></li><li class="list-group-item archive_link"><a href="http://HarvestingClouds.com/archive/september-2016">September 2016</a></li><li class="list-group-item archive_link"><a href="http://HarvestingClouds.com/archive/august-2016">August 2016</a></li><li class="list-group-item archive_link"><a href="http://HarvestingClouds.com/archive/july-2016">July 2016</a></li><li class="list-group-item archive_link"><a href="http://HarvestingClouds.com/archive/may-2016">May 2016</a></li><li class="list-group-item archive_link"><a href="http://HarvestingClouds.com/archive/april-2016">April 2016</a></li></ul>
                </div>
        
            <!-- Tags -->
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <strong>Tags Cloud</strong>
                    </div>
        
                    <div class="panel-body">
                        <ul class="list-inline">
                            <a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/net" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">net</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/activedirectory" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">activedirectory</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/ad" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">ad</a>
<a style="font-size: 14px" class="tag_cloud" href="http://HarvestingClouds.com/tag/announcement" title="3 total posts" data-original-title="4 total posts" data-toggle="tooltip">announcement</a>
<a style="font-size: 27px" class="tag_cloud" href="http://HarvestingClouds.com/tag/arm" title="16 total posts" data-original-title="17 total posts" data-toggle="tooltip">ARM</a>
<a style="font-size: 14px" class="tag_cloud" href="http://HarvestingClouds.com/tag/arm" title="3 total posts" data-original-title="4 total posts" data-toggle="tooltip">arm</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/asm" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">asm</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/asr" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">ASR</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/automation" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">automation</a>
<a style="font-size: 30px" class="tag_cloud" href="http://HarvestingClouds.com/tag/azure" title="18 total posts" data-original-title="19 total posts" data-toggle="tooltip">Azure</a>
<a style="font-size: 22px" class="tag_cloud" href="http://HarvestingClouds.com/tag/azure" title="11 total posts" data-original-title="12 total posts" data-toggle="tooltip">azure</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/azureautomation" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">azureautomation</a>
<a style="font-size: 28px" class="tag_cloud" href="http://HarvestingClouds.com/tag/azureresourcemanager" title="17 total posts" data-original-title="18 total posts" data-toggle="tooltip">AzureResourceManager</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/azureresourcemanager" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">azureresourcemanager</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/azureservicemanagement" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">azureservicemanagement</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/azuresiterecovery" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">AzureSiteRecovery</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/blob" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">blob</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/csharp" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">csharp</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/datacenter" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">datacenter</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/dsc" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">dsc</a>
<a style="font-size: 14px" class="tag_cloud" href="http://HarvestingClouds.com/tag/general" title="3 total posts" data-original-title="4 total posts" data-toggle="tooltip">general</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/gridmvc" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">gridmvc</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/json" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">JSON</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/mvc" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">mvc</a>
<a style="font-size: 14px" class="tag_cloud" href="http://HarvestingClouds.com/tag/powershell" title="3 total posts" data-original-title="4 total posts" data-toggle="tooltip">powershell</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/powershell" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">PowerShell</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/remoteapp" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">RemoteApp</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/sample" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">Sample</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/script" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">Script</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/storage" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">storage</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/tags" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">Tags</a>
<a style="font-size: 26px" class="tag_cloud" href="http://HarvestingClouds.com/tag/templates" title="15 total posts" data-original-title="16 total posts" data-toggle="tooltip">Templates</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/virtualmachine" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">virtualmachine</a>
<a style="font-size: 13px" class="tag_cloud" href="http://HarvestingClouds.com/tag/visualstudio" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">VisualStudio</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/vm" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">vm</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/vmware" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">VMWare</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/webdevelopment" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">webdevelopment</a>
<a style="font-size: 12px" class="tag_cloud" href="http://HarvestingClouds.com/tag/windows" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">windows</a>

                        </ul>
                    </div>
                </div>
            </div>

    </div>
</div>

<!-- Footer -->
<footer>
    <div class="container">
        <hr/>
        <p class="text-center">&copy; <script> document.write( new Date().getFullYear()) </script> <strong><a href="http://HarvestingClouds.com">Harvesting Clouds</a></strong></p>
    </div>
</footer>

<!-- Jquery and Bootstrap Script files -->
<script src="http://HarvestingClouds.com/js/jquery-2.0.3.min.js"></script>
<script src="http://HarvestingClouds.com/js/plugins/bootstrap-3.0.3/js/bootstrap.min.js"></script>
<script src="http://HarvestingClouds.com/js/plugins/highlight/highlight.pack.js"></script>
<script src="http://HarvestingClouds.com/js/plugins/lightbox/ekko-lightbox.min.js"></script>

<script>
    var __blogURL = 'http://HarvestingClouds.com';
</script>

<script src="http://HarvestingClouds.com/js/blog.js"></script>
<script src="http://HarvestingClouds.com/js/search.js"></script>

<!-- google analytics -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75855204-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>
<!-- for pagination -->
<script>
    $(function () {

        ///////////////////////////////////////////////////
        // class/id/selector of prev link
        var $prevPostSelector = $('.prevpost');
        var $nextPostSelector = $('.nextpost');
        ///////////////////////////////////////////////////

        var pageArray = document.location.href.split('/');
        var currentPageSlug = pageArray[pageArray.length - 1];

        if (!currentPageSlug) {
            currentPageSlug = pageArray[pageArray.length - 2];
        }

        $.ajax({
            url: __blogURL + "/data/blog.json",
            type: "GET",
            dataType: "json",
            success: function (data) {
                if (data.posts !== undefined && data.posts !== null) {
                    $.each(data.posts, function (i, post) {
                        if (post.slug === currentPageSlug || post.slug + '/' === currentPageSlug) {

                            var prevPost = data.posts[i - 1];
                            var nextPost = data.posts[i + 1];

                            if (prevPost === undefined || prevPost === null) {
                                // hide previous link if it is first post
                                $prevPostSelector.hide();
                            }
                            else {
                                $prevPostSelector.attr('href', __blogURL + '/post/' + prevPost.slug);
                            }

                            if (nextPost === undefined || nextPost === null) {
                                // hide previous link if it is last post
                                $nextPostSelector.hide();
                            }
                            else {
                                $nextPostSelector.attr('href', __blogURL + '/post/' + nextPost.slug);
                            }

                            return false; // break out of each
                        }
                    });
                }
            },
            error: function (e) {
                $prevPostSelector.hide();
                $nextPostSelector.hide();
            }
        });

        // for Disqus
        var disqus_shortname = 'harvestingclouds';
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

    });
</script>
