<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="BloggerCMS" />
    <meta name="description" content="Blog about all things regarding private and public clouds">
    <meta name="author" content="@20aman">

    <title>Step by Step ARM Templates - Using Key Vault to Securly Provide Information in ARM Templates :: Harvesting Clouds</title>

    <!-- rss feed url -->
    <link rel="alternate" type="application/rss+xml" title="Harvesting Clouds" href="https://harvestingclouds.com/rss.xml"/>

    <!-- favicon -->
    <link rel="shortcut icon" href="/favicon.ico"/>
    <link rel="shortcut icon" href="https://harvestingclouds.com/favicon.ico"/>

    <!-- Bootstrap CSS file -->
    <link href="https://harvestingclouds.com/js/plugins/bootstrap-3.0.3/css/cerulean.min.css" rel="stylesheet"/>
    <link href="https://harvestingclouds.com/js/plugins/font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://harvestingclouds.com/js/plugins/bootstrap-3.0.3/plugins/social-buttons.css" rel="stylesheet"/>

    <!-- syntax highlighter css file -->
    <link href="https://harvestingclouds.com/js/plugins/highlight/styles/github.css" rel="stylesheet"/>

    <!-- lightbox for images -->
    <link href="https://harvestingclouds.com/js/plugins/lightbox/ekko-lightbox.min.css" rel="stylesheet"/>

    <!-- blog custom CSS file -->
    <link href="https://harvestingclouds.com/css/style.css" rel="stylesheet"/>
</head><body>
<!-- Header -->
<header class="navbar navbar-default
 navbar-fixed-top bs-docs-nav" role="banner">
    <div class="container">

        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a href="https://HarvestingClouds.com" class="navbar-brand">Harvesting Clouds</a>

        </div>


        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
            <div class="navbar-form navbar-right" role="search">
                <div class="form-group">
                    <input type="text" class="searchQuery form-control" placeholder="Search Posts">
                </div>

                <button type="button" class="searchButton btn btn-default"><i class="glyphicon glyphicon-search"></i>
                    Submit
                </button>
            </div>

            <ul class="nav navbar-nav page-links">
                <li><a href="https://harvestingclouds.com/posts.html">All Posts</a></li>
                    <li><a href="https://harvestingclouds.com/page/about-me">About Me</a></li>
            </ul>

        </nav>
    </div>
</header>
<div class="container">
    <div class="row">
        <div class="col-md-8 main-content">
            <article>
                <h3>Step by Step ARM Templates - Using Key Vault to Securly Provide Information in ARM Templates</h3>
                <span class="glyphicon glyphicon-user"></span> @20aman
                &nbsp;&nbsp;
                <span class="glyphicon glyphicon-time"></span> Oct 18, 2016
                <hr>

                <p class="post-content"><p>When providing passwords and other secure and confidential information in ARM Templates, you need to ensure that you don't hard code these values anywhere. You don't need to compromise the security of the system while trying to automate deployments. Your end goal is to try to automate as much as possible and reduce manual involvement. </p>
<p><strong>Key Vaults</strong> are there to solve this problem without compromising any security. In fact, they make the whole solution more secure with least manual intervention.</p>
<h3>Setting up the Key Vault</h3>
<p>We first need to setup the Key Vault in Azure to be able to use it via ARM Template parameters.</p>
<ol>
    <li>
<b>Create a Key Vault in Azure</b> by going to <i>New -> Security + Identity -> Key Vault</i>. Provide a name, subscription, resource group etc. and provision the Key Vault. Once it is created navigate to it by clicking on "More Services" and searching for Key Vault. Click on the name of the vault you created.

<b>Note</b> that this feature is in Preview  at the time of writing of this blog.

    </li>

    <li>
        Next, we need to <b>Add a Secret</b> in the key vault. Click on the Secrets as shown below:
<br />
<img alt="Adding Secret" src="/images/1476818644580676d447b16.png" />
<br />
Next, in the "Create a secret" blade, set the Upload Options to Manual. Provide a name and value to the secret. Value is the password you want to securely save.
Ensure that the Enabled is set to Yes. Optionally you can set the activation and expiration dates
<img alt="Creating Secret" src="/images/1476818650580676da89fee.png" />
    </li>

    <li>
        Next, we will set the <b>Access Policies </b> to provide access to the user under the context of which the template will be deployed. This is the user which will be accessing the Key Vault. Go to Key Vault settings and select Access Policies. Add the new user as shown below:

<img alt="Access Policies" src="/images/14768190995806789bad0c4.png" />
<br />

    </li>

    <li>
        Next, we will set the <b>Advanced Access Policies </b> to indicate that this key vault can be accessed via ARM Templates. Go to Key Vault settings and select Advanced Access Policies. Ensure that the checkbox for "<i>Enable access to Azure Resource Manager for template deployment</i>" is checked as shown below:

<img alt="Access Policies" src="/images/1476819105580678a1cfc9f.png" />
<br /> 

    </li>

</ol>
<p>We are now all set with our Key Vault. Next, we will be using the secret we created to set the local Administrator user's password.</p>
<h3>Using the Key Vault Secret in ARM Template</h3></p>
                <br/><br/>

                <div class="post-info">
                        <span class="glyphicon glyphicon-folder-open"></span> &nbsp;
                        <a href="https://harvestingclouds.com/category/azure">Azure</a>
                        &nbsp;&nbsp;

                    <span class="glyphicon glyphicon-bookmark"></span>

                        <a href="https://harvestingclouds.com/tag/ARM">ARM</a>&nbsp;&nbsp;
                        <a href="https://harvestingclouds.com/tag/Azure">Azure</a>&nbsp;&nbsp;
                        <a href="https://harvestingclouds.com/tag/AzureResourceManager">AzureResourceManager</a>&nbsp;&nbsp;
                        <a href="https://harvestingclouds.com/tag/Templates">Templates</a>&nbsp;&nbsp;
                        <a href="https://harvestingclouds.com/tag/KeyVault">KeyVault</a>&nbsp;&nbsp;
                </div>

            </article>
            <hr/>

            <div class="text-center clearfix">
                <div class="col-sm-4 col-md-4">
                    <a class="prevpost btn btn-primary"><i class="fa fa-chevron-circle-left"></i> Prev Post</a>
                </div>
                <div class="col-sm-4 col-md-4">
                    <a class="btn btn-primary" href="https://harvestingclouds.com/posts.html"><i class="fa fa-navicon"></i> View All
                        Post</a>
                </div>
                <div class="col-sm-4 col-md-4">
                    <a class="nextpost btn btn-primary"><i class="fa fa-chevron-circle-right"></i> Next Post</a>
                </div>
            </div>

            <hr/>
            
            <!-- Comment form -->
            <div class="well">
                <div id="disqus_thread"></div>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">Comments
                    powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">Comments powered by
                    <span class="logo-disqus">Disqus</span></a>
            </div>

        </div>

        <div class="sidebar col-md-4">
        
            <!-- Follow Panel -->
                <div class="panel panel-primary text-center">
                    <div class="panel-heading">
                        <strong>Follow Me</strong>
                    </div>
        
                    <div class="panel-body">
                        <a target="_blank" href="https://harvestingclouds.com/rss.xml" class="btn btn-social-icon btn-outline"><i class="fa fa-rss"></i></a>
        
                            <a target="_blank" href="https://twitter.com/20aman" class="btn btn-social-icon btn-twitter"><i class="fa fa-twitter"></i></a>
                            <a target="_blank" href="https://ca.linkedin.com/in/20aman" class="btn btn-social-icon btn-linkedin"><i class="fa fa-linkedin"></i></a>
                            <a target="_blank" href="https://github.com/HarvestingClouds" class="btn btn-social-icon btn-github"><i class="fa fa-github"></i></a>
                    </div>
                </div>
        
            <!-- Custom Values from Settings page -->
        
            <!-- Latest Posts -->
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <strong>Latest Posts</strong>
                </div>
        
                <ul class="list-group">
                        <li class="list-group-item"><a href="https://harvestingclouds.com/post/step-by-step-arm-templates-using-key-vault-to-securly-provide-information-in-arm-templates">Step by Step ARM Templates - Using Key Vault to Securly Provide Information in ARM Templates</a></li>
                        <li class="list-group-item"><a href="https://harvestingclouds.com/post/step-by-step-arm-templates-visualizing-arm-templates-and-generating-diagrams">Step by Step ARM Templates - Visualizing ARM Templates and Generating Diagrams</a></li>
                        <li class="list-group-item"><a href="https://harvestingclouds.com/post/azure-automation-preview-solution-start-stop-vms-during-off-hours">Azure Automation Preview Solution - Start/Stop VMs during off-hours </a></li>
                        <li class="list-group-item"><a href="https://harvestingclouds.com/post/azure-remoteapp-is-going-away-new-purchases-in-portal-are-now-stopped">Azure RemoteApp is going away. New Purchases in portal are now stopped </a></li>
                        <li class="list-group-item"><a href="https://harvestingclouds.com/post/step-by-step-azure-resource-manager-arm-templates-index">Step by Step Azure Resource Manager (ARM) Templates - Index</a></li>
                </ul>
            </div>
        
            <!-- Categories -->
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <strong>Categories</strong>
                </div>
        
                <ul class="list-group">
                        <li class="list-group-item"><a href="https://harvestingclouds.com/category/azure">Azure</a></li>
                        <li class="list-group-item"><a href="https://harvestingclouds.com/category/general">General</a></li>
                        <li class="list-group-item"><a href="https://harvestingclouds.com/category/powershell">PowerShell</a></li>
                        <li class="list-group-item"><a href="https://harvestingclouds.com/category/web-development">Web Development</a></li>
                </ul>
            </div>
        
            <!-- Archives -->
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <strong>Archives</strong>
                    </div>
        
                    <ul class="archives list-group"><li class="list-group-item archive_link"><a href="https://harvestingclouds.com/archive/october-2016">October 2016</a></li><li class="list-group-item archive_link"><a href="https://harvestingclouds.com/archive/september-2016">September 2016</a></li><li class="list-group-item archive_link"><a href="https://harvestingclouds.com/archive/august-2016">August 2016</a></li><li class="list-group-item archive_link"><a href="https://harvestingclouds.com/archive/july-2016">July 2016</a></li><li class="list-group-item archive_link"><a href="https://harvestingclouds.com/archive/may-2016">May 2016</a></li><li class="list-group-item archive_link"><a href="https://harvestingclouds.com/archive/april-2016">April 2016</a></li></ul>
                </div>
        
            <!-- Tags -->
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <strong>Tags Cloud</strong>
                    </div>
        
                    <div class="panel-body">
                        <ul class="list-inline">
                            <a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/net" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">net</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/activedirectory" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">activedirectory</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/ad" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">ad</a>
<a style="font-size: 13px" class="tag_cloud" href="https://harvestingclouds.com/tag/announcement" title="3 total posts" data-original-title="4 total posts" data-toggle="tooltip">announcement</a>
<a style="font-size: 27px" class="tag_cloud" href="https://harvestingclouds.com/tag/arm" title="18 total posts" data-original-title="19 total posts" data-toggle="tooltip">ARM</a>
<a style="font-size: 13px" class="tag_cloud" href="https://harvestingclouds.com/tag/arm" title="3 total posts" data-original-title="4 total posts" data-toggle="tooltip">arm</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/asm" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">asm</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/asr" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">ASR</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/automation" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">automation</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/automation" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">Automation</a>
<a style="font-size: 30px" class="tag_cloud" href="https://harvestingclouds.com/tag/azure" title="21 total posts" data-original-title="22 total posts" data-toggle="tooltip">Azure</a>
<a style="font-size: 21px" class="tag_cloud" href="https://harvestingclouds.com/tag/azure" title="11 total posts" data-original-title="12 total posts" data-toggle="tooltip">azure</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/azureautomation" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">azureautomation</a>
<a style="font-size: 29px" class="tag_cloud" href="https://harvestingclouds.com/tag/azureresourcemanager" title="20 total posts" data-original-title="21 total posts" data-toggle="tooltip">AzureResourceManager</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/azureresourcemanager" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">azureresourcemanager</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/azureservicemanagement" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">azureservicemanagement</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/azuresiterecovery" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">AzureSiteRecovery</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/blob" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">blob</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/csharp" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">csharp</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/datacenter" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">datacenter</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/dsc" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">dsc</a>
<a style="font-size: 13px" class="tag_cloud" href="https://harvestingclouds.com/tag/general" title="3 total posts" data-original-title="4 total posts" data-toggle="tooltip">general</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/gridmvc" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">gridmvc</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/json" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">JSON</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/keyvault" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">KeyVault</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/mvc" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">mvc</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/powershell" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">PowerShell</a>
<a style="font-size: 13px" class="tag_cloud" href="https://harvestingclouds.com/tag/powershell" title="3 total posts" data-original-title="4 total posts" data-toggle="tooltip">powershell</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/remoteapp" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">RemoteApp</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/runbooks" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">Runbooks</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/sample" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">Sample</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/script" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">Script</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/storage" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">storage</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/tags" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">Tags</a>
<a style="font-size: 26px" class="tag_cloud" href="https://harvestingclouds.com/tag/templates" title="17 total posts" data-original-title="18 total posts" data-toggle="tooltip">Templates</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/virtualmachine" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">virtualmachine</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/visualstudio" title="2 total posts" data-original-title="3 total posts" data-toggle="tooltip">VisualStudio</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/vm" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">vm</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/vmware" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">VMWare</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/webdevelopment" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">webdevelopment</a>
<a style="font-size: 12px" class="tag_cloud" href="https://harvestingclouds.com/tag/windows" title="1 total posts" data-original-title="2 total posts" data-toggle="tooltip">windows</a>

                        </ul>
                    </div>
                </div>
            </div>

    </div>
</div>

<!-- Footer -->
<footer>
    <div class="container">
        <hr/>
        <p class="text-center">&copy; <script> document.write( new Date().getFullYear()) </script> <strong><a href="https://HarvestingClouds.com">Harvesting Clouds</a></strong></p>
    </div>
</footer>

<!-- Jquery and Bootstrap Script files -->
<script src="https://harvestingclouds.com/js/jquery-2.0.3.min.js"></script>
<script src="https://harvestingclouds.com/js/plugins/bootstrap-3.0.3/js/bootstrap.min.js"></script>
<script src="https://harvestingclouds.com/js/plugins/highlight/highlight.pack.js"></script>
<script src="https://harvestingclouds.com/js/plugins/lightbox/ekko-lightbox.min.js"></script>

<script>
    var __blogURL = 'https://HarvestingClouds.com';
</script>

<script src="https://harvestingclouds.com/js/blog.js"></script>
<script src="https://harvestingclouds.com/js/search.js"></script>

<!-- google analytics -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75855204-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>
<!-- for pagination -->
<script>
    $(function () {

        ///////////////////////////////////////////////////
        // class/id/selector of prev link
        var $prevPostSelector = $('.prevpost');
        var $nextPostSelector = $('.nextpost');
        ///////////////////////////////////////////////////

        var pageArray = document.location.href.split('/');
        var currentPageSlug = pageArray[pageArray.length - 1];

        if (!currentPageSlug) {
            currentPageSlug = pageArray[pageArray.length - 2];
        }

        $.ajax({
            url: __blogURL + "/data/blog.json",
            type: "GET",
            dataType: "json",
            success: function (data) {
                if (data.posts !== undefined && data.posts !== null) {
                    $.each(data.posts, function (i, post) {
                        if (post.slug === currentPageSlug || post.slug + '/' === currentPageSlug) {

                            var prevPost = data.posts[i - 1];
                            var nextPost = data.posts[i + 1];

                            if (prevPost === undefined || prevPost === null) {
                                // hide previous link if it is first post
                                $prevPostSelector.hide();
                            }
                            else {
                                $prevPostSelector.attr('href', __blogURL + '/post/' + prevPost.slug);
                            }

                            if (nextPost === undefined || nextPost === null) {
                                // hide previous link if it is last post
                                $nextPostSelector.hide();
                            }
                            else {
                                $nextPostSelector.attr('href', __blogURL + '/post/' + nextPost.slug);
                            }

                            return false; // break out of each
                        }
                    });
                }
            },
            error: function (e) {
                $prevPostSelector.hide();
                $nextPostSelector.hide();
            }
        });

        // for Disqus
        var disqus_shortname = 'harvestingclouds';
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

    });
</script>
